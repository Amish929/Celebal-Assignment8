Task: Create a CI/CD pipeline to build and push a Docker image to ACR and deploy to ACI.

ğŸ”§ Step 1: Azure Setup
1.1 Create Azure Resources
Go to https://portal.azure.com:

âœ… Create a Resource Group
Name: devops-demo-rg

Region: your preferred location

âœ… Create ACR (Azure Container Registry)
Name: myacramish (must be unique)

SKU: Basic

Enable public access (default)

1.2 Create Azure DevOps Project
Go to https://dev.azure.com

Create a new project: DockerToACI

ğŸ“ Step 2: Repo Setup in Azure DevOps
Go to Repos â†’ Files â†’ New and create these files:

ğŸ”¹ Dockerfile
FROM python:3.10-slim
WORKDIR /app
COPY app.py .
COPY requirements.txt .
RUN pip install -r requirements.txt
CMD ["python", "app.py"]

ğŸ”¹ app.py
from flask import Flask
app = Flask(__name__)

@app.route('/')
def hello():
    return "Hello from ACI!"

if __name__ == "__main__":
    app.run(host='0.0.0.0', port=80)

ğŸ”¹ requirements.txt
flask

ğŸ” Step 3: Service Connection in Azure DevOps
ğŸ”¹ Create Azure Resource Manager Service Connection
Go to Project Settings â†’ Service connections

Click + New service connection

Choose Azure Resource Manager

Use automatic method (sign in)

Select your subscription and resource group

Name it: azure-rm-connection

âœ… Check Grant access to all pipelines

âš™ï¸ Step 4: CI/CD YAML Pipeline
Go to Pipelines â†’ New Pipeline â†’ Select YAML
Create a new file: azure-pipelines.yml

Paste the following:

ğŸ“„ azure-pipelines.yml
trigger:
- main

variables:
  imageName: 'myapp'
  acrName: 'myacramish'
  aciName: 'aci-myapp'
  resourceGroup: 'devops-demo-rg'
  location: 'eastus'  # Change if needed

stages:
- stage: BuildAndPush
  displayName: 'Build & Push Docker Image to ACR'
  jobs:
  - job: Build
    pool:
      vmImage: 'ubuntu-latest'
    steps:
    - task: AzureCLI@2
      inputs:
        azureSubscription: 'azure-rm-connection'
        scriptType: 'bash'
        scriptLocation: 'inlineScript'
        inlineScript: |
          az acr login --name ${{ variables.acrName }}
          docker build -t ${{ variables.acrName }}.azurecr.io/${{ variables.imageName }}:$(Build.BuildId) .
          docker push ${{ variables.acrName }}.azurecr.io/${{ variables.imageName }}:$(Build.BuildId)

- stage: DeployToACI
  displayName: 'Deploy to Azure Container Instance'
  dependsOn: BuildAndPush
  jobs:
  - job: Deploy
    pool:
      vmImage: 'ubuntu-latest'
    steps:
    - task: AzureCLI@2
      inputs:
        azureSubscription: 'azure-rm-connection'
        scriptType: 'bash'
        scriptLocation: 'inlineScript'
        inlineScript: |
          az container delete --name ${{ variables.aciName }} --resource-group ${{ variables.resourceGroup }} --yes || true
          az container create \
            --name ${{ variables.aciName }} \
            --resource-group ${{ variables.resourceGroup }} \
            --image ${{ variables.acrName }}.azurecr.io/${{ variables.imageName }}:$(Build.BuildId) \
            --dns-name-label aci-myapp-${{ Build.BuildId }} \
            --ports 80 \
            --location ${{ variables.location }} \
            --registry-login-server ${{ variables.acrName }}.azurecr.io \
            --restart-policy OnFailure

ğŸš€ Step 5: Run the Pipeline
Go to Pipelines â†’ Run pipeline

It will:

âœ… Build Docker image

âœ… Push to ACR

âœ… Deploy container to ACI

ğŸŒ Step 6: Access the App
After successful deployment:

Go to Azure Portal â†’ Resource group â†’ devops-demo-rg â†’ Container Instances

Open the created container (e.g., aci-myapp)

Copy the FQDN (Fully Qualified Domain Name)

Open it in your browser:
http://aci-myapp-<buildId>.<region>.azurecontainer.io

âœ… You should see: â€œHello from ACI!â€